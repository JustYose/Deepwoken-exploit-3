local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Deepwoken","DarkTheme")
local Main = Window:NewTab("Main")
local MainSection = Main:NewSection("Main")
local Esp_On = true
local NoClipping = false
local Flying = false
local FlySpeed = 0
local Userinputservice = game:GetService("UserInputService")
local Autolootall = false
local Autolootlegendaries = false
local Autolootenchants = false
local EspSize = 200
local Nofalldamage = false

local Whitelist = {[3484658446]=true, [3490325571]=true, [2234520373]=true, [939144838]=true, [3021493178]=true, [115608485]=true}
if Whitelist[game.Players.LocalPlayer.UserId] == nil then
    game.Players.LocalPlayer:Kick("Not whitelisted")
end

function Alarm()
	local Sound = Instance.new("Sound",game.Players.LocalPlayer.Character.Head)
	Sound.SoundId = "rbxassetid://2778386920"
	Sound.Volume = 10
	Sound:Play()
	task.wait(5)
	Sound:Destroy()
end

task.spawn(function()
	for _, Player in next, game.Players:GetPlayers() do
		if Player:GetRankInGroup(5212858) > 0 then
			game.StarterGui:SetCore("SendNotification",{
				Title = "A Moderator Joined",
				Text = Player.Name.." Joined",
				Icon = nil,
				Duration = "20",
			})
			Alarm()
		end
	end
end)

task.spawn(function()
	game.Players.PlayerAdded:Connect(function(Player)
		if Player:GetRankInGroup(5212858) > 0 then
			game.StarterGui:SetCore("SendNotification",{
				Title = "A Moderator Joined",
				Text = Player.Name.." Joined",
				Icon = nil,
				Duration = "5",
			})
			Alarm()
		end
	end)
end)

task.spawn(function()
	game.Players.PlayerRemoving:Connect(function(Player)
		if Player:GetRankInGroup(5212858) > 0 then
			game.StarterGui:SetCore("SendNotification",{
				Title = "A Moderator Left",
				Text = Player.Name.." Left",
				Icon = nil,
				Duration = "5",
			})
		end
	end)
end)

function CreateEsp(Character,Color,IsChest)
	pcall(function()
		if Character.PrimaryPart then
			local Esp = Instance.new("BillboardGui",Character)
			Esp.Name = "Esp"
			Esp.AlwaysOnTop = true
			Character.Esp.Size = UDim2.new(0,EspSize,0,EspSize)
			local CharacterName = Instance.new("TextLabel",Esp)
			CharacterName.Name = "CharacterName"
			CharacterName.AnchorPoint = Vector2.new(.5,.5)
			CharacterName.BackgroundTransparency = 1
			CharacterName.Position = UDim2.new(.5,0,.15,0)
			CharacterName.Size = UDim2.new(1,0,.3,0)
			CharacterName.TextScaled = true
			CharacterName.TextColor3 = Color
			if not IsChest then
			    CharacterName.Text = "["..Character.Name.."]["..tostring(math.ceil(Character.Humanoid.Health)).."/"..tostring(math.ceil(Character.Humanoid.MaxHealth)).."]["..tostring(math.ceil((Character.PrimaryPart.Position-game.Players.LocalPlayer.Character.PrimaryPart.Position).Magnitude)).."]"
		    else
			    CharacterName.Text = "[Chest]["..tostring(math.ceil((Character.PrimaryPart.Position-game.Players.LocalPlayer.Character.PrimaryPart.Position).Magnitude)).."]"
		    end
		end
	end)
end

function UpdateEsp(Character,IsChest)
	if Character:FindFirstChild("Esp") then
		Character.Esp.Adornee = Character.PrimaryPart
		if not IsChest then
	    	Character.Esp.Size = UDim2.new(0,EspSize,0,EspSize)
	    	Character.Esp.CharacterName.Text = "["..Character.Name.."]["..tostring(math.ceil(Character.Humanoid.Health)).."/"..tostring(math.ceil(Character.Humanoid.MaxHealth)).."]["..tostring(math.ceil((Character.PrimaryPart.Position-game.Players.LocalPlayer.Character.PrimaryPart.Position).Magnitude)).."]"
	    else
	    	Character.Esp.Size = UDim2.new(0,EspSize/2,0,EspSize/2)
	   		Character.Esp.CharacterName.Text = "[Chest]["..tostring(math.ceil((Character.PrimaryPart.Position-game.Players.LocalPlayer.Character.PrimaryPart.Position).Magnitude)).."]"
	    end
		return true
	end
	return false
end

if Esp_On then
	game:GetService("RunService"):BindToRenderStep("Esp",Enum.RenderPriority.Last.Value,function()
		pcall(function()
			for _, Character in next, workspace.Live:GetChildren() do
				if Character:FindFirstChild("Humanoid") then
					if not UpdateEsp(Character) then
						if game.Players:GetPlayerFromCharacter(Character) then
							CreateEsp(Character,Color3.fromRGB(255, 90, 35))
						else
							CreateEsp(Character,Color3.fromRGB(255, 255, 255))
						end
					end
				end
			end
			for _, Chest in next, workspace.Thrown:GetChildren() do
			    if Chest:IsA("Model") and Chest:FindFirstChild("Lid") and Chest:FindFirstChild("RootPart") then
					if not UpdateEsp(Chest,true) then
						CreateEsp(Chest,Color3.fromRGB(255, 255, 255),true)
					end
			    end
			end
		end)
	end)
end

MainSection:NewKeybind("Esp", "Esp for players, mobs and chests", Enum.KeyCode.Z, function()
	Esp_On = not Esp_On
	if Esp_On then
		game:GetService("RunService"):BindToRenderStep("Esp",Enum.RenderPriority.Last.Value,function()
			pcall(function()
				for _, Character in next, workspace.Live:GetChildren() do
					if Character:FindFirstChild("Humanoid") then
						if not UpdateEsp(Character) then
							if game.Players:GetPlayerFromCharacter(Character) then
								CreateEsp(Character,Color3.fromRGB(255, 90, 35))
							else
								CreateEsp(Character,Color3.fromRGB(255, 255, 255))
							end
						end
					end
				end
		    	for _, Chest in next, workspace.Thrown:GetChildren() do
			        if Chest:IsA("Model") and Chest:FindFirstChild("Lid") and Chest:FindFirstChild("RootPart") then
				    	if not UpdateEsp(Chest,true) then
					    	CreateEsp(Chest,Color3.fromRGB(255, 255, 255),true)
					    end
			        end
			    end
			end)
		end)
	else
		pcall(function()
			for _, Character in next, workspace.Live:GetDescendants() do
				if Character:FindFirstChild("Esp") then
					Character.Esp:Destroy()
				end
			end
			for _, Chest in next, workspace.Thrown:GetDescendants() do
				if Chest:FindFirstChild("Esp") then
					Chest.Esp:Destroy()
				end
			end
		end)
		game:GetService("RunService"):UnbindFromRenderStep("Esp")
	end
end)
MainSection:NewKeybind("Fly", "The keybind for flying", Enum.KeyCode.J, function()
	if Flying then
		task.spawn(function()
			NoClipping = false
		end)
		Flying = false
		game.Players.LocalPlayer.Character.Animate.Disabled = false
	else
		Flying = true
		game.Players.LocalPlayer.Character.Animate.Disabled = true
		local bv = Instance.new("BodyVelocity", game.Players.LocalPlayer.Character.PrimaryPart)
		bv.MaxForce = Vector3.new(math.huge,math.huge,math.huge)
		bv.Velocity = Vector3.new(0,0,0)
		bv.Name = "FlightForce"
		repeat wait(0.1) until Flying == false
		bv:Destroy()
	end
end)
MainSection:NewKeybind("Noclip", "The keybind for noclip", Enum.KeyCode.M, function()
	if not NoClipping then
		NoClipping = true
	else
		NoClipping = false
	end
end)
MainSection:NewKeybind("Toggle Ui", "The keybind for opening/closing ui", Enum.KeyCode.F1, function()
	Library:ToggleUI()
end)
MainSection:NewToggle("No fall damage", "Immunity for fall damage", function()
	Nofalldamage = not Nofalldamage
	if Nofalldamage then
	    local newpart = Instance.new("Part",workspace)
	    newpart.Name = "nofalldamagebrrrpart"
	    newpart.Transparency = 1
	    newpart.CanCollide = true
	    newpart.Anchored = true
		game:GetService("RunService"):BindToRenderStep("Esp",Enum.RenderPriority.Last.Value,function()
    		pcall(function()
    		    workspace.nofalldamagebrrrpart.Position = game.Players.LocalPlayer.Character.PrimaryPart.Position-Vector3.new(0,6,0)
    		end)
		end)
	else
	    workspace.nofalldamagebrrrpart:Destroy()
		game:GetService("RunService"):UnbindFromRenderStep("Esp")
	end
end)
MainSection:NewSlider("Fly Speed", "How fast you can fly", 200, 0, function(s)
	FlySpeed = s
end)
MainSection:NewSlider("Esp Size", "The size of esp", 300, 100, function(s)
	EspSize = s
end)
local Players = Window:NewTab("Players")
local PlayersSection = Players:NewSection("Players")
PlayersSection:NewTextBox("Spectate (In works)", "Type a player name to spectate them",function(text)
    playertospectate = text
end)
PlayersSection:NewButton("Stop Spectating", "Stop spectating players",function()
    playertospectate = nil
end)
local Loot = Window:NewTab("Loot")
local LootSelection = Loot:NewSection("Loot")
LootSelection:NewToggle("Auto Loot All", "Automatically gives you all the loot", function(v)
	Autolootall = v
end)
LootSelection:NewToggle("Auto Loot Legendary", "Automatically gives you legendaries in chests", function(v)
	Autolootlegendaries = v
end)
LootSelection:NewToggle("Auto Loot Enchants", "Automatically gives you enchants in chests", function(v)
	Autolootenchants = v
end)

function GetColor(color)
	local R,G,B = color.R*255,color.G*255,color.B*255
	R = math.floor(R)
	G = math.floor(G)
	B = math.floor(B)
	return {R = R,G = G,B = B}
end

function IsClose(number1,number2,number3,number21,number22,number23)
	if number1 >= number21-5 and number1 <= number21+5 then
		if number2 >= number22-5 and number2 <= number22+5 then
			if number3 >= number23-5 and number3 <= number23+5 then
				return true
			end
		end
	end
	return false
end

while wait() do
	task.spawn(function()
		if Flying then
			NoClipping = true
			local FlightForce = Instance.new("BodyVelocity", game.Players.LocalPlayer.Character.PrimaryPart)
			FlightForce.MaxForce = Vector3.new(math.huge,math.huge,math.huge)
			FlightForce.Velocity = Vector3.new(0,0,0)
			FlightForce.Name = "FlightForce"
			FlightForce.Velocity = Vector3.new(0,0,0)
			if Userinputservice:IsKeyDown(Enum.KeyCode.W) then
				FlightForce.Velocity = workspace.CurrentCamera.CFrame.LookVector * FlySpeed
			end
			if Userinputservice:IsKeyDown(Enum.KeyCode.S) then
				FlightForce.Velocity = workspace.CurrentCamera.CFrame.LookVector * -FlySpeed
			end
			if Userinputservice:IsKeyDown(Enum.KeyCode.A) then
				FlightForce.Velocity = workspace.CurrentCamera.CFrame.RightVector * -FlySpeed
			end
			if Userinputservice:IsKeyDown(Enum.KeyCode.D) then
				FlightForce.Velocity = workspace.CurrentCamera.CFrame.RightVector * FlySpeed
			end
		end
	end)
	task.spawn(function()
		if NoClipping then
			game.Players.LocalPlayer.Character.Head.CanCollide = false
			game.Players.LocalPlayer.Character.Torso.CanCollide = false
		else
			game.Players.LocalPlayer.Character.Head.CanCollide = true
			game.Players.LocalPlayer.Character.Torso.CanCollide = true
		end
	end)
	task.spawn(function()
		if game.Players.LocalPlayer:FindFirstChild("PlayerGui") and game.Players.LocalPlayer.PlayerGui:FindFirstChild("ChoicePrompt") then
			for _, Choice in next, game.Players.LocalPlayer.PlayerGui.ChoicePrompt.ChoiceFrame.Options:GetChildren() do
				if Choice:IsA("TextButton") then
					local color = GetColor(Choice.BackgroundColor3)
					if Autolootenchants then
						if IsClose(color.R,color.G,color.B,227,254,232) then
							game.Players.LocalPlayer.PlayerGui.ChoicePrompt.Choice:FireServer(Choice.Name)
						end
					end
					if Autolootlegendaries then
						if IsClose(color.R,color.G,color.B,164,120,50) then
							game.Players.LocalPlayer.PlayerGui.ChoicePrompt.Choice:FireServer(Choice.Name)
						end
					end
					if Autolootall then
						if Choice.Name ~= "Nothing" then
							game.Players.LocalPlayer.PlayerGui.ChoicePrompt.Choice:FireServer(Choice.Name)
						end
					end
				end
			end
		end
	end)
end
